%\let\origlstlisting=\lstlisting
%\let\endoriglstlisting=\endlstlisting
%\renewenvironment{lstlisting}
%    {\mathcode`\-=\hyphenmathcode
%     \everymath{}\mathsurround=0pt\origlstlisting}
%    {\endoriglstlisting}

\lstdefinestyle{c}{
language=C,
basicstyle=\small\ttfamily,
numbers=left,
numberstyle=\tiny,
frame=L,
columns=fullflexible,
showstringspaces=false
}

\lstdefinelanguage{pseudoC}%
  {morekeywords={auto,boolean,
      break,case,char,const,continue,default,do,double,%
      else,enum,extern,float,for,goto,if,int,long,register,return,%
      short,signed,sizeof,static,struct,switch,typedef,union,unsigned,%
      void,volatile,while,sync,shared,int32,int16,int8,int64},%
  sensitive,%
  morecomment=[s]{/*}{*/},%
  morecomment=[l]//,% nonstandard
  morestring=[b]",%
  morestring=[m]',% changed from `b' to `m'
  moredelim=*[directive]\#,%
  moredirectives={define,elif,else,endif,error,if,ifdef,ifndef,line,%
  include,pragma,undef,warning}%
}[keywords,comments,strings,directives]%

\lstdefinestyle{pseudoc}{
  language=pseudoC,
  basicstyle=\small\ttfamily,
  numbers=left,
  numberstyle=\tiny,
%  frame=L,
  columns=fullflexible,
  showstringspaces=false,
  frame=single,
  captionpos=b
}

\lstnewenvironment{ccode}[1]{
  \mathligsoff
  \lstset{style=pseudoC}
  \lstset{literate={'}{{'}}1}
  \lstset{literate={\ }{{ }}1}
  \lstset{#1}
}{}

\DeclareCaptionFormat{listing}{#1#2#3}
\captionsetup[lstlisting]{format=listing,singlelinecheck=false, margin=0pt, font={sf}}